// Generated by CoffeeScript 1.9.1
var StatusPageWidget;

StatusPageWidget = (function() {
  StatusPageWidget.prototype.pageId = null;

  StatusPageWidget.prototype.options = {
    alwaysShow: false,
    linkNewWindow: true,
    updateInterval: 0
  };

  StatusPageWidget.prototype.page = null;

  StatusPageWidget.prototype.data = null;

  StatusPageWidget.prototype.div = null;

  function StatusPageWidget(pageId, options) {
    this.pageId = pageId;
    this.processOptions(options);
    this.page = new StatusPage.page({
      page: this.pageId
    });
    this.updateStatus();
    if (this.options.updateInterval) {
      setInterval((function(_this) {
        return function() {
          return _this.updateStatus();
        };
      })(this), this.options.updateInterval * 1000);
    }
  }

  StatusPageWidget.prototype.processOptions = function(options) {
    var key, results, val;
    if (typeof options !== 'object') {
      return;
    }
    results = [];
    for (key in options) {
      val = options[key];
      results.push(this.options[key] = val);
    }
    return results;
  };

  StatusPageWidget.prototype.updateStatus = function() {
    return this.page.status({
      success: (function(_this) {
        return function(data) {
          _this.data = data;
          return _this.updateDiv();
        };
      })(this)
    });
  };

  StatusPageWidget.prototype.updateDiv = function() {
    if (!this.data || !this.data.status) {
      return;
    }
    if (this.data.status.indicator === 'none' && !this.options.alwaysShow) {
      if (this.div) {
        this.div.remove();
        this.div = null;
      }
      return;
    }
    if (!this.div) {
      this.div = document.createElement('div');
      this.div.className = 'status-page-container';
      document.body.appendChild(this.div);
    }
    return this.div.innerHTML = '<a class="status-page-link status-page-indicator-' + this.data.status.indicator + '" href="https://' + this.pageId + '.statuspage.io/" target="' + (this.options.linkNewWindow === true ? '_blank' : '_top') + '">' + this.data.status.description + ' &rarr;</a>';
  };

  return StatusPageWidget;

})();
